if (( ! $+commands[fzf] )); then
  return
fi
local line=$(fc -ln -1 0 | fzf --no-sort --height=40% --border=none --no-info)
local ret=$?
if [[ -z $line ]]; then
  return $ret
fi
if [[ -n $WIDGET ]]; then
  # We're invoked as a ZLE widget
  BUFFER=$line
  CURSOR=$#BUFFER
  zle reset-prompt
else
  print $line
fi
return $ret
