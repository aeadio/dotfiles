#!/bin/sh

fail() {
  printf '%s\n' $1 >&2
  exit 1
}

current="$(beadm list -H | awk '$2 ~ /N/ {print $1}')"
if [ -z "$current" ]; then
  fail "unable to determine running boot environment"
fi

beadm create "$current-$(date +%Y.%m.%d-%H:%M)" &&
beadm list
