#!/bin/sh

exec  >/dev/null
exec 2>/dev/null

browser() {
	url=
	case "$1" in
		http://* | https://* | file://*)
			url="$1"
			;;
		*)
			url="http://$1"
			;;
	esac
	"${BROWSER:-xdg-open}" "$url"
}

editor() {
	terminal "${VISUAL:-${EDITOR:-micro}}" "$1"
}

filemanager() {
	terminal ranger "$1"
}

imageviewer() {
	img --title "feh-float" -g "1920x1080" "$1"
}

get-desktop-apps | menu -d ' |' | while read selection; do
	case "$selection" in
	  *.desktop)
			dex "$selection"
			;;
		\:* | http://* | https://*) # URL
			browser "${selection#:}" &
			;;
		\?*) # web search
			browser "https://www.google.com/search?q=${selection#?}" &
			;;
		\$*) # terminal
			terminal -f ${selection#$} &
			;;
		*)   # handle as file
			case "$selection" in \~/* | \~) selection="$HOME${selection#'~'}" ;; esac
			if [ -e "$selection" ]; then
				case "$(file -Lb --mime-type "$selection")" in
					application/pdf)
						browser "file://$selection"
						;;
					text/* | inode/x-empty | message/rfc822)
						editor "$selection"
						;;
					inode/directory)
						filemanager "$selection"
						;;
					image/*)
						imageviewer "$selection"
						;;
				esac
			fi
			;;
	esac
done
