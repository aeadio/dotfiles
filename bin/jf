#!/usr/bin/env bash
# vim: ft=bash ts=2 sw=2 et:

if [[ -z $1 ]] || [[ $1 == "-" ]]; then
  input="$(mktemp)"
  trap "rm -f \"$input\"" EXIT
  cat /dev/stdin > "$input"
else
  input="$1"
fi

# path logic inspired by https://github.com/stedolan/jq/issues/243
<"$input" jq -r '[
    path(..) |
    map(select(type=="string") // "[]") |
    join(".") | split(".[]") | join("[]")
  ] | map("." + .) | unique | .[]' |
fzf \
  --preview "jq --color-output $JQ_REPL_ARGS {q} \"$input\"" \
  --preview-window="down:90%" \
  --height="99%" \
  --query="." \
  --bind "tab:replace-query,return:print-query" \
  --bind "alt-up:preview-page-up,alt-down:preview-page-down"
